<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [coalesceCallback](#coalescecallback)
-   [CoalesceResult](#coalesceresult)
-   [coalesce](#coalesce)
-   [PhrasematchSubqObject](#phrasematchsubqobject)
-   [MemoryCache](#memorycache)
    -   [list](#list)
    -   [set](#set)
    -   [get](#get)
    -   [MemoryCache](#memorycache-1)
    -   [getmatching](#getmatching)
    -   [pack](#pack)
-   [NormalizationCache](#normalizationcache)
    -   [get](#get-1)
    -   [getPrefixRange](#getprefixrange)
    -   [getAll](#getall)
    -   [writeBatch](#writebatch)
    -   [NormalizationCache](#normalizationcache-1)
-   [RocksDBCache](#rocksdbcache)
    -   [pack](#pack-1)
    -   [get](#get-2)
    -   [get](#get-3)
    -   [list](#list-1)
    -   [merge](#merge)
    -   [RocksDBCache](#rocksdbcache-1)

## coalesceCallback

Type: [Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)

**Parameters**

-   `err`  error if any, or null if not
-   `results` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[CoalesceResult](#coalesceresult)>** the results of the coalesce operation

## CoalesceResult

A member of the result set from a coalesce operation.

**Properties**

-   `x` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the X tile coordinate of the result
-   `y` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the Y tile coordinate of the result
-   `relev` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the computed relevance of the result
-   `score` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the computed score of the result
-   `id` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the feature ID of the result
-   `idx` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the index ID (preserved from the inbound subquery) of the index the result came from
-   `tmpid` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** a composite ID used for uniquely identifying features across indexes that incorporates the ID and IDX
-   `distance` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the distance metric computed using the feature and proximity, if supplied; 0 otherwise
-   `scoredist` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the composite score incorporating the feature's score with the distance (or the score if distance is 0)
-   `matches_language` **[Boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** whether or not the match is valid for one of the languages in the inbound languages array

## coalesce

The coalesce function determines whether or not phrase matches in different
carmen indexes align spatially, and computes information about successful matches
such as combined relevance and score. The computation is done on the thread pool,
and exposed asynchronously to JS via a callback argument.

**Parameters**

-   `phrasematches` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[PhrasematchSubqObject](#phrasematchsubqobject)>** an array of PhrasematchSubqObject objects, each of which describes a match candidate
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** options for how to perform the coalesce operation that aren't specific to a particular subquery
    -   `options.radius` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** the fall-off radius for determining how wide-reaching the effect of proximity bias is
    -   `options.centerzxy` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>?** a 3-number array representing the ZXY of the tile on which the proximity point can be found
    -   `options.bboxzxy` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>?** a 5-number array representing the zoom, minX, minY, maxX, and maxY values of the tile cover of the requested bbox, if any
-   `callback` **[coalesceCallback](#coalescecallback)** the callback function

## PhrasematchSubqObject

The PhrasematchSubqObject type describes the metadata known about possible matches to be assessed for stacking by
coalesce as seen from Javascript. Note: it is of similar purpose to the PhrasematchSubq C++ struct type, but differs
slightly in specific field names and types.

**Properties**

-   `phrase` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The matched string
-   `weight` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** A float between 0 and 1 representing how much of the query this string covers
-   `prefix` **[Boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** whether or not to do a prefix scan (as opposed to an exact match scan); used for autocomplete
-   `idx` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** an identifier of the index the match came from; opaque to carmen-cache but returned in results
-   `zoom` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the configured tile zoom level for the index
-   `mask` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** a bitmask representing which tokens in the original query the subquery covers
-   `languages` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** a list of the language IDs to be considered matching
-   `cache` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** the carmen-cache from the index in which the match was found

## MemoryCache

### list

Lists the keys in the store of the MemoryCache Object

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const MemoryCache = new cache.MemoryCache('a');

cache.list('a', (err, result) => {
   if (err) throw err;
   console.log(result);
});
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

### set

Replaces or appends the data for a given key

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `null` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** , data; an array of numbers where each number represents a grid
-   `an` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** array of relevant languages
-   `T` **[Boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** : append to data, F: replace data

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const MemoryCache = new cache.MemoryCache('a');

cache.set('a', [1,2,3], (err, result) => {
     if (err) throw err;
     console.log(result)
});
```

Returns **any** undefined

### get

Retrieves data exactly matching phrase and language settings by id

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `matches_prefixes` **[Boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** : T if it matches exactly, F: if it does not
-   `optional` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** ; array of languages

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const MemoryCache = new cache.MemoryCache('a');

MemoryCache.get(id, languages);
 // => [grid, grid, grid, grid... ]
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** integers referring to grids

### MemoryCache

Creates an in-memory key-value store mapping phrases  and language IDs
to lists of corresponding grids (grids ie are integer representations of occurrences of the phrase within an index)

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const MemoryCache = new cache.MemoryCache(id, languages);
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** grid of integers

### getmatching

Retrieves data matching phrase and/or language settings by id.
If match_prefixes is true, anything that starts with that phrase,
and also for any entry regardless of language,
and with a relevance penalty applied to languages that don't match those requested.

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `matches_prefixes` **[Boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** : T if it matches exactly, F: if it does not
-   `optional` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** ; array of languages

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const MemoryCache = new cache.MemoryCache('a');

MemoryCache.getmatching(id, languages);
 // => [grid, grid, grid, grid... ]
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** integers referring to grids

### pack

creates database from filename
optimize a memory cache and write to disc as rocksdbcache

**Parameters**

-   `null` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** , filename

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const MemoryCache = new cache.MemoryCache('a');

cache.pack('filename');
```

Returns **any** undefined

## NormalizationCache

NormalizationCache represents an one-to-many integer-to-integer
mapping where each integer is assumed to be the position of a given term
in a lexicographically-sorted vocabulary. The purpose of the cache is to capture
equivalencies between different elements in the dictionary, such that further metadata
(e.g., in a RocksDBCache) can be stored only for the canonical form of a given name.
The structure is stored using a RocksDB database on disk.

### get

retrieve the indices of the canonical labels for the index of a given non-canonical label

**Parameters**

-   `id` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const nc = new cache.NormalizationCache('file.norm.rocksdb', true);

// for a normalization cache for the dictionary ['main st', 'main street']
// where 'main st' is canonical
const canonical = nc.get(1); // returns [0]
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

### getPrefixRange

given that in a lexicographically sorted list, all terms that share a prefix
are grouped together, this function retrieves the indices of all canonical forms
of all terms that share a given prefix as indicated by the index of the first term
in the shared prefix list and the number of terms that share a prefix, for which the canonical
form does not also share that same prefix

**Parameters**

-   `start_id` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `count` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `scan_max` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** the maximum number of entries to scan
-   `return_max` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** the maximum number of indices to return

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const nc = new cache.NormalizationCache('file.norm.rocksdb', true);

// for a normalization cache for the dictionary
// ['saint marks ave', 'saint peters ave', 'st marks ave', 'st peters ave']
// where the 'st ...' forms are canonical
const canonical = nc.getPrefixRange(0, 2); // looks up all the canonical
                                           // forms for things that begin with
                                           // 'saint'
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

### getAll

retrieve the entire contents of a NormalizationCache, as an array of arrays

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const nc = new cache.NormalizationCache('file.norm.rocksdb', true);

// for a normalization cache for the dictionary
// ['saint marks ave', 'saint peters ave', 'st marks ave', 'st peters ave']
// where the 'st ...' forms are canonical
const canonical = nc.getAll() // returns [[0, [2]], [1, [3]]]
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

### writeBatch

bulk-set the contents of a NormalizationCache to an array of arrays

**Parameters**

-   `data` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** the values to be written to the cache, in the form \[\[from, [to, to, ...]], ...]

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const nc = new cache.NormalizationCache('file.norm.rocksdb', true);

// for a normalization cache for the dictionary
// ['saint marks ave', 'saint peters ave', 'st marks ave', 'st peters ave']
// where the 'st ...' forms are canonical
nc.writeBatch([[0, [2]], [1, [3]]]);
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

### NormalizationCache

Constructor for NormalizationCache pointing to an on-disk RocksDB database
to be used for reading or writing.

**Parameters**

-   `filename` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `read-only` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const nc = new cache.NormalizationCache('file.norm.rocksdb', false);
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

## RocksDBCache

### pack

Writes an identical copy RocksDBCache from another RocksDBCache; not really used

**Parameters**

-   `null` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** , filename

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const RocksDBCache = new cache.RocksDBCache('a');

cache.pack('filename');
```

Returns **[Boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

### get

Retrieves data exactly matching phrase and language settings by id

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `matches_prefixes` **[Boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** : T if it matches exactly, F: if it does not
-   `optional` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** ; array of languages

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const RocksDBCache = new cache.RocksDBCache('a');

RocksDBCache.get(id, languages);
 // => [grid, grid, grid, grid... ]
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** integers referring to grids

### get

Retrieves grid that at least partially matches phrase and/or language inputs

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `matches_prefixes` **[Boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** : T if it matches exactly, F: if it does not
-   `optional` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** ; array of languages

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const RocksDBCache = new cache.RocksDBCache('a');

RocksDBCache.get(id, languages);
 // => [grid, grid, grid, grid... ]
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** integers referring to grids

### list

lists the keys in the RocksDBCache object

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const RocksDBCache = new cache.RocksDBCache('a');

cache.list('a', (err, result) => {
   if (err) throw err;
   console.log(result);
});
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** Set of keys/ids

### merge

merges the contents from 2 RocksDBCaches

**Parameters**

-   `RocksDBCache` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** file 1
-   `RocksDBCache` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** file 2
-   `result` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** RocksDBCache file
-   `method` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** which is either concat or freq
-   `callback` **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** called from the mergeAfter method

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const RocksDBCache = new cache.RocksDBCache('a');

cache.merge('file1', 'file2', 'resultFile', 'method', (err, result) => {
   if (err) throw err;
   console.log(result);
});
```

Returns **[Set](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Set)** Set of ids

### RocksDBCache

Creates an in-memory key-value store mapping phrases  and language IDs
to lists of corresponding grids (grids ie are integer representations of occurrences of the phrase within an index)

**Parameters**

-   `id` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `filename` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

**Examples**

```javascript
const cache = require('@mapbox/carmen-cache');
const RocksDBCache = new cache.RocksDBCache('a', 'filename');
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
